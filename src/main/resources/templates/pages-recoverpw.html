<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>FOREST物业管理系统后台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description"/>
    <meta content="Coderthemes" name="author"/>
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <!-- App css -->
    <link href="assets/css/icons.min1.css" rel="stylesheet" type="text/css"/>
    <link href="assets/css/app.min1.css" rel="stylesheet" type="text/css"/>
    <script src="js/username.js"></script>
    <style type="text/css">
        .mmm {
            font-size: 10px;
            color: red;
        }
    </style>
    <script src="js/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="webjars/sweetalert2/10.10.0/dist/sweetalert2.min.css">
    <script src="webjars/sweetalert2/10.10.0/dist/sweetalert2.min.js"></script>
</head>

<body class="authentication-bg">

<div class="account-pages mt-5 mb-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5">
                <div class="card">
                    <!-- Logo -->
                    <div class="card-header pt-4 pb-4 text-center bg-primary">
                        <a href="index.html">
                            <span><img src="assets/images/logo.png" alt="" height="18"></span>
                        </a>
                    </div>

                    <div class="card-body p-4">

                        <div class="text-center w-75 m-auto">
                            <h4 class="text-dark-50 text-center mt-0 font-weight-bold">重置密码</h4>
                            <p class="text-muted mb-4">请输入您的基本信息和新的登录密码</p>
                        </div>


                        <div class="form-group">
                            <label for="XtYongPassward">新密码:<span id="XtYong_2"></span></label>
                            <input class="form-control" type="password" id="XtYongPassward" required
                                   placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="XtYongPassward_1">确认密码:<span id="XtYong_3"></span></label>
                            <input class="form-control" type="password" id="XtYongPassward_1" required
                                   placeholder="请再次输入密码">
                        </div>
                        <div class="form-group">
                            <label for="XtYongName">用户姓名:<span id="XtYong_4"></span></label>
                            <input class="form-control" type="text" required id="XtYongName" placeholder="请输入用户姓名">
                        </div>
                        <div class="form-group">
                            <label for="XtYongHuSFZ">身份证号:<span id="XtYong_5"></span></label>
                            <input class="form-control" type="text" required id="XtYongHuSFZ" placeholder="请输入身份证号">
                        </div>
                        <div class="form-group mb-0 text-center">
                            <button class="btn btn-primary" type="submit" id="updates">重置密码</button>
                        </div>
                        </form>
                    </div> <!-- end card-body-->
                </div>
                <!-- end card -->

                <div class="row mt-3">
                    <div class="col-12 text-center">
                        <p class="text-muted">Back to <a href="pages-register.html"
                                                         class="text-muted ml-1"><b>注册</b></a></p>
                    </div> <!-- end col -->
                </div>
                <!-- end row -->

            </div> <!-- end col -->
        </div>
        <!-- end row -->
    </div>
    <!-- end container -->
</div>
<!-- end page -->

<footer class="footer footer-alt">
    2020 - 2021 © Hyper - Coderthemes.com
</footer>

<!-- App js -->
<script src="assets/js/app.min.js"></script>
</body>


<script type="text/javascript">
    var imgObjTrue1 = $("<img src='assets/true.jpg' height=\"22\" width=\"23\">");
    var imgObjFalse1 = $("<img src='assets/false.jpg' height=\"22\" width=\"23\">");
    //密码验证
    var flas1 = false;
    $("#XtYongPassward").blur(function () {
        var pass = $("#XtYongPassward").val(); //
        //密码规则为字母+数字的组合，不得出现特殊字符
        var patrm1 = /^[a-z0-9]{6,10}$/;
        if (pass == null || pass == "") {
            $("#XtYong_2").empty();
            var XtYong_2 = $("<span class='mmm'>登录密码不能为空,请重新输入</span>");
            $("#XtYong_2").append(imgObjFalse1);
            $("#XtYong_2").append(XtYong_2);
            $("#XtYongPassward").val("");
            flas1 = false;
        } else if (!patrm1.test(pass)) {
            $("#XtYong_2").empty();
            var XtYong_2 = $("<span class='mmm'>小写字母+数字，不得出现特殊字符，长度为6-10</span>");
            $("#XtYong_2").append(imgObjFalse1);
            $("#XtYong_2").append(XtYong_2);
            $("#XtYongPassward").val("");
            flas1 = false;
        } else {
            $("#XtYong_2").empty();
            $("#XtYong_2").append(imgObjTrue1);
            flas1 = true;
            return;
        }

    });
    var imgObjTrue2 = $("<img src='assets/true.jpg' height=\"22\" width=\"23\">");
    var imgObjFalse2 = $("<img src='assets/false.jpg' height=\"22\" width=\"23\">");
    //重复密码验证
    var flas2 = false;
    $("#XtYongPassward_1").blur(function () {
        var pass2 = $("#XtYongPassward_1").val(); //
        var pass1 = $("#XtYongPassward").val();

        if (pass2 == null || pass2 == "") {
            $("#XtYong_3").empty();
            var XtYong_3 = $("<span class='mmm'>密码验证不能为空,请重新输入</span>");
            $("#XtYong_3").append(imgObjFalse2);
            $("#XtYong_3").append(XtYong_3);
            $("#XtYongPassward_1").val("");
            flas2 = false;
        } else if (pass2 != pass1) {
            $("#XtYong_3").empty();
            var XtYong_3 = $("<span class='mmm'>两次密码输入不一致，请重新输入</span>");
            $("#XtYong_3").append(imgObjFalse2);
            $("#XtYong_3").append(XtYong_3);
            $("#XtYongPassward_1").val("");
            flas2 = false;
        } else {
            $("#XtYong_3").empty();
            $("#XtYong_3").append(imgObjTrue2);
            flas2 = true;
            return;
        }

    });
    var imgObjTrue3 = $("<img src='assets/true.jpg' height=\"22\" width=\"23\">");
    var imgObjFalse3 = $("<img src='assets/false.jpg' height=\"22\" width=\"23\">");
    //用户姓名验证
    var flas3 = false;
    $("#XtYongName").blur(function () {
        var nc = $("#XtYongName").val(); //
        var pattern = /^[\u4E00-\u9FA5]{2,6}$/;
        if (nc == null || nc == "") {
            $("#XtYong_4").empty();
            var XtYong_4 = $("<span class='mmm'>用户姓名输入不能为空，请重新输入</span>");
            $("#XtYong_4").append(imgObjFalse3);
            $("#XtYong_4").append(XtYong_4);
            $("#XtYongName").val("");
            flas3 = false;
        } else if (!pattern.test(nc)) {
            $("#XtYong_4").empty();
            var XtYong_4 = $("<span class='mmm'>请输入中文名称</span>");
            $("#XtYong_4").append(imgObjFalse3);
            $("#XtYong_4").append(XtYong_4);
            $("#XtYongName").val("");
            flas3 = false;
        } else {
            $("#XtYong_4").empty();
            $("#XtYong_4").append(imgObjTrue3);
            flas3 = true;
            return;
        }


    });
    //身份证验证
    var imgObjTrue4 = $("<img src='assets/true.jpg' height=\"22\" width=\"23\">");
    var imgObjFalse4 = $("<img src='assets/false.jpg' height=\"22\" width=\"23\">");
    var flas4 = false;
    $("#XtYongHuSFZ").blur(function () {
        var sfz = $("#XtYongHuSFZ").val(); //
        //判断是身份证正则表达式
        var aa = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;

        if (sfz == null || sfz == "") {
            $("#XtYong_5").empty();
            var XtYong_5 = $("<span class='mmm'>身份证号输入不能为空，请重新输入</span>");
            $("#XtYong_5").append(imgObjFalse4);
            $("#XtYong_5").append(XtYong_5);
            $("#XtYongHuSFZ").val("");
            flas4 = false;

        } else if (!aa.test(sfz) || sfz.length != 18) {
            $("#XtYong_5").empty();
            var XtYong_5 = $("<span class='mmm'>身份证号输入有误，请重新输入</span>");
            $("#XtYong_5").append(imgObjFalse4);
            $("#XtYong_5").append(XtYong_5);
            $("#XtYongHuSFZ").val("");
            flas4 = false;
        } else {
            $("#XtYong_5").empty();
            $("#XtYong_5").append(imgObjTrue4);
            flas4 = true;
            return;
        }

    });

    //重置密码
    function update() {
        var XtYongPassward = $("#XtYongPassward").val();  //用户密码
        var XtYongPassward_1 = $("#XtYongPassward_1").val();//再次输入密码
        var XtYongName = $("#XtYongName").val();          //用户姓名
        var XtYongHuSFZ = $("#XtYongHuSFZ").val();        //身份证号
        swal.fire({
            type: 'warning', // 弹框类型
            title: '提示', //标题
            text: "请确认此信息是否正确", //显示内容
            confirmButtonColor: '#3085d6',// 确定按钮的 颜色
            confirmButtonText: '确定',// 确定按钮的 文字
            showCancelButton: true, // 是否显示取消按钮
            cancelButtonColor: '#d33', // 取消按钮的 颜色
            cancelButtonText: "取消", // 取消按钮的 文字
            focusCancel: true, // 是否聚焦 取消按钮
            reverseButtons: true  // 是否 反转 两个按钮的位置 默认是  左边 确定  右边 取消
        }).then(function (isConfirm) {
            if (isConfirm.value) {
                if (flas1 == true && flas2 == true && flas3 == true && flas4 == true) {
                    var data = {
                        "xtYongMiMa": XtYongPassward,
                        "xtYongName": XtYongName,
                        "xtYongHuSFZ": XtYongHuSFZ
                    };
                    $.ajax({
                        url: "update",
                        type: "POST",
                        dataType: "json",
                        contentType: 'application/json;charset=utf-8',
                        data: JSON.stringify(data),
                        async: false,
                        success: function (data) {
                            if (data.code == 200) {
                                window.location.href = userUrl + "/pages-login.html";
                            } else if (data.code = 400) {
                                Swal.fire("提示", "非常抱歉，你的身份信息未注册！", "err0r");
                                $("#XtYongPassward").val("");  //用户密码
                                $("#XtYongPassward_1").val("");//再次输入密码
                                $("#XtYongName").val("");          //用户姓名
                                $("#XtYongHuSFZ").val("");        //身份证号
                            } else {
                                Swal.fire("提示", "请输入完整数据", "question");
                            }
                        }
                    });
                } else {
                    Swal.fire("提示", "输入数据有误", "question");
                }
            } else {
                Swal.fire("提示", "已取消提交", "error");
            }
        })


    }

    $(function () {
        //点击注册
        $("#updates").click(function () {
            update();

        })

    });
</script>
</html>
